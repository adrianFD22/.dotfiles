#!/bin/bash

battery=$(cat /sys/class/power_supply/BAT0/capacity)
charging=$(cat /sys/class/power_supply/BAT0/status)
temp_notify="/tmp/dwmblocks-battery-notification"
temp_full="/tmp/dwmblocks-battery-full"

if [ $charging = "Charging" ]; then
    if ! [[ -f $temp_notify ]]; then
        touch $temp_notify
        echo -e "SEC:1\tTAG:battery\tCharging âš¡" > $XNOTIFY_FIFO
    fi
    if ! [[ -f $temp_full ]]; then
        touch $temp_full
    fi
    printf "%sâš¡" $battery

elif [ $charging = "Full" ]; then
    if [[ -f $temp_full ]]; then
        rm $temp_full
        echo -e "SEC:3\tTAG:battery\tFully chargedâš¡" > $XNOTIFY_FIFO
    fi
    printf "%sðŸ”‹" $battery

elif (( $battery > 10 )); then
    if ! [[ -f $temp_notify ]]; then
        touch $temp_notify
        echo -e "SEC:1\tTAG:battery\tDischarging âš¡" > $XNOTIFY_FIFO
    fi
    printf "%sðŸ”‹" $battery
else
    if [[ -f $temp_notify ]]; then
        rm $temp_notify
        echo -e "TAG:battery\tLow batteryðŸª«" > $XNOTIFY_FIFO
    fi
    printf "%sðŸª«" $battery
fi
